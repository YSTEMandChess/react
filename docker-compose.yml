version: '3.8'

#services:
#  nginx:
#    image: nginx:stable
#    ports:
#      - "80:80"
#    volumes:
#      - ./nginx/proxy.conf:/etc/nginx/conf.d/default.conf:ro
#    depends_on:
#      - chessClient
#      - middlewareNode
#      - chessServer
#      - stockfishServer

services:
  apache:
    image: httpd:2.4
    ports:
      - "80:80"
    volumes:
      - ./apache/httpd.conf:/usr/local/apache2/conf/httpd.conf:ro
    depends_on:
      - chessClient
      - middlewareNode
      - chessServer
      - stockfishServer

  chessClient:
    build: ./chessClient
    container_name: chessclient
    # Expose port used by the client dev server or static server. Adjust if different.
    expose:
      - "3000"

  middlewareNode:
    build: ./middlewareNode
    container_name: middlewarenode
    # The Node server in middlewareNode/server.js uses PORT 8000 by default in repo.
    expose:
      - "8000"

  chessServer:
    build: ./chessServer
    container_name: chessserver
    expose:
      - "3002"

  stockfishServer:
    build: ./stockfishServer
    container_name: stockfishserver
    expose:
      - "9324"

# Notes:
# - This compose file uses nginx as a reverse proxy and builds each service from the
#   Dockerfiles already in the repository. Adjust `expose` ports to match each
#   service's internal listening port.
# - To run locally: docker-compose up --build
# - If you prefer Apache as reverse proxy, replace the nginx service with an httpd image and a config file.

