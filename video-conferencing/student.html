<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agora Video Chat</title>
    <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #video-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            width: 80%;
        }
        video {
            width: 100%;
            height: auto;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <p>STUDENT</p>
        <div id="local-video"></div>
        <div id="remote-video"></div>
    </div>


    <script>

        const APP_ID = "0f03b7d5ff73444ba3331fc7297881b6"; // Replace with your Agora App ID
        const TOKEN = null;//"6aff97bc467b4bf59fb17c5f02d68e5f"; // Replace with your token
        const CHANNEL = null; // Replace with your channel name
        const UID = null; // Replace with person1's unique ID

        const client = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });

        // Listen for messages from the parent window
        window.addEventListener("start", (e) => {
            // Validate the message origin for security (optional)
            // if (event.origin !== "http://trusted-origin.com") return;

            // parse message
            let data = JSON.parse(e.data);

            // get command from parent and send to server
            var mentorID = data.mentor;
            var studentID = data.student;

            CHANNEL = mentorID;
            UID = studentID;

            console.log("Received message from parent:", e.data);

            startVideoChat();
        });


        async function joinConference() {
            try {
                // Join the channel as a subscriber
                await client.join(APP_ID, CHANNEL, TOKEN, UID);
                console.log("Joined channel as subscriber.");

                // Subscribe to any remote user who publishes media
                client.on("user-published", async (user, mediaType) => {
                    console.log("User published:", user.uid);

                    // Subscribe to the user's media
                    await client.subscribe(user, mediaType);
                    console.log("Subscribed to user:", user.uid);

                    if (mediaType === "video") {
                        // Play the remote video
                        const remoteVideoTrack = user.videoTrack;
                        remoteVideoTrack.play("remote-video");
                    }

                    if (mediaType === "audio") {
                        // Play the remote audio
                        const remoteAudioTrack = user.audioTrack;
                        remoteAudioTrack.play(); // Plays audio directly (no DOM element needed)
                    }
                });

                // Handle a user leaving/unpublishing
                client.on("user-unpublished", (user) => {
                    console.log("User unpublished:", user.uid);
                    document.getElementById("remote-video").innerHTML = ""; // Clear remote video
                });

                client.on("user-left", (user) => {
                    console.log("User left:", user.uid);
                });
            } catch (error) {
                console.error("Error joining conference:", error);
            }
        }
    </script>

    
</body>
</html>
